<script lang="ts">
import type { Editor } from "$lib/editor";
import { draggable } from "@neodrag/svelte";
import { setContext } from "svelte";
import KanaButton from "./KanaButton.svelte";

let { editor, shown = $bindable(false) }: { editor: Editor; shown?: boolean } =
	$props();
setContext("editor", editor);

const KANA_TABLE = [
	["ã‚", ["ð›€‚", "ð›€…", "ð›€ƒ", "ð›€„"]],
	["ã„", ["ð›€†", "ð›€‡", "ð›€ˆ", "ð›€‰"]],
	["ã†", ["ð›€Š", "ð›€‹", "ð›€Œ", "ð›€", "ð›€Ž"]],
	["ãˆ", ["ð›€", "ð›€", "ð›€", "ð›€‘", "ð›€’", "ð›€“"]],
	["ãŠ", ["ð›€”", "ð›€•", "ð›€–"]],
	[
		"ã‹",
		["ð›€—", "ð›€˜", "ð›€™", "ð›€š", "ð›€›", "ð›€¢", "ð›€œ", "ð›€", "ð›€ž", "ð›€Ÿ", "ð›€ ", "ð›€¡"],
	],
	["ã", ["ð›€£", "ð›€¤", "ð›€¥", "ð›€¦", "ð›€»", "ð›€§", "ð›€¨", "ð›€©", "ð›€ª"]],
	["ã", ["ð›€«", "ð›€¬", "ð›€­", "ð›€®", "ð›€¯", "ð›€°", "ð›€±"]],
	["ã‘", ["ð›€³", "ð›€²", "ð›€¢", "ð›€´", "ð›€µ", "ð›€¶", "ð›€·"]],
	["ã“", ["ð›€¸", "ð›‚˜", "ð›€¹", "ð›€»", "ð›€º"]],
	["ã•", ["ð›€¼", "ð›€½", "ð›€¾", "ð›€¿", "ð›€", "ð›", "ð›‚", "ð›ƒ"]],
	["ã—", ["ð›„", "ð›…", "ð›†", "ð›‡", "ð›ˆ", "ð›‰"]],
	["ã™", ["ð›Š", "ð›‹", "ð›Œ", "ð›", "ð›Ž", "ð›", "ð›", "ð›‘"]],
	["ã›", ["ð›’", "ð›“", "ð›”", "ð›•", "ð›–"]],
	["ã", ["ð›—", "ð›˜", "ð›™", "ð›š", "ð››", "ð›œ", "ð›"]],
	["ãŸ", ["ð›ž", "ð›Ÿ", "ð› ", "ð›¡"]],
	["ã¡", ["ð›¢", "ð›£", "ð›¤", "ð›¥", "ð›¦", "ð›§", "ð›¨"]],
	["ã¤", ["ð›©", "ð›ª", "ð›«", "ð›¬", "ð›­"]],
	["ã¦", ["ð›®", "ð›¯", "ð›°", "ð›±", "ð›²", "ð›³", "ð›´", "ð›µ", "ð›¶", "ð›‚Ž"]],
	["ã¨", ["ð›·", "ð›¸", "ð›¹", "ð›º", "ð›»", "ð›¼", "ð›½", "ð›­"]],
	["ãª", ["ð›¾", "ð›¿", "ð›‚€", "ð›‚", "ð›‚‚", "ð›‚ƒ", "ð›‚„", "ð›‚…", "ð›‚†"]],
	["ã«", ["ð›‚‡", "ð›‚ˆ", "ð›‚‰", "ð›‚Š", "ð›‚‹", "ð›‚Œ", "ð›‚", "ð›‚Ž"]],
	["ã¬", ["ð›‚", "ð›‚", "ð›‚‘"]],
	["ã­", ["ð›‚’", "ð›‚“", "ð›‚”", "ð›‚•", "ð›‚–", "ð›‚—", "ð›‚˜"]],
	["ã®", ["ð›‚™", "ð›‚š", "ð›‚›", "ð›‚œ", "ð›‚"]],
	["ã¯", ["ð›‚ž", "ð›‚Ÿ", "ð›‚ ", "ð›‚¡", "ð›‚¢", "ð›‚£", "ð›‚¤", "ð›‚¥", "ð›‚¦", "ð›‚§", "ð›‚¨"]],
	["ã²", ["ð›‚©", "ð›‚ª", "ð›‚«", "ð›‚¬", "ð›‚­", "ð›‚®", "ð›‚¯"]],
	["ãµ", ["ð›‚°", "ð›‚±", "ð›‚²"]],
	["ã¸", ["ð›‚³", "ð›‚´", "ð›‚µ", "ð›‚¶", "ð›‚·", "ð›‚¸", "ð›‚¹"]],
	["ã»", ["ð›‚º", "ð›‚»", "ð›‚¼", "ð›‚½", "ð›‚¾", "ð›‚¿", "ð›ƒ€", "ð›ƒ"]],
	["ã¾", ["ð›ƒ‚", "ð›ƒƒ", "ð›ƒ„", "ð›ƒ…", "ð›ƒ†", "ð›ƒ‡", "ð›ƒˆ", "ð›ƒ–"]],
	["ã¿", ["ð›ƒ‰", "ð›ƒŠ", "ð›ƒ‹", "ð›ƒŒ", "ð›ƒ", "ð›ƒŽ", "ð›ƒ"]],
	["ã‚€", ["ð›ƒ", "ð›ƒ‘", "ð›ƒ’", "ð›ƒ“", "ð›„", "ð›„ž"]],
	["ã‚", ["ð›ƒ”", "ð›ƒ•", "ð›ƒ–"]],
	["ã‚‚", ["ð›ƒ—", "ð›ƒ˜", "ð›ƒ™", "ð›ƒš", "ð›ƒ›", "ð›ƒœ", "ð›„", "ð›„ž"]],
	["ã‚„", ["ð›ƒ", "ð›ƒž", "ð›ƒŸ", "ð›ƒ ", "ð›ƒ¡", "ð›ƒ¢"]],
	null,
	["ã‚†", ["ð›ƒ£", "ð›ƒ¤", "ð›ƒ¥", "ð›ƒ¦"]],
	null,
	["ã‚ˆ", ["ð›ƒ§", "ð›ƒ¨", "ð›ƒ©", "ð›ƒª", "ð›ƒ«", "ð›ƒ¬"]],
	["ã‚‰", ["ð›ƒ­", "ð›ƒ®", "ð›ƒ¯", "ð›ƒ°"]],
	["ã‚Š", ["ð›ƒ±", "ð›ƒ²", "ð›ƒ³", "ð›ƒ´", "ð›ƒµ", "ð›ƒ¶", "ð›ƒ·"]],
	["ã‚‹", ["ð›ƒ¸", "ð›ƒ¹", "ð›ƒº", "ð›ƒ»", "ð›ƒ¼", "ð›ƒ½"]],
	["ã‚Œ", ["ð›ƒ¾", "ð›ƒ¿", "ð›„€", "ð›„"]],
	["ã‚", ["ð›„‚", "ð›„ƒ", "ð›„„", "ð›„…", "ð›„†", "ð›„‡"]],
	["ã‚", ["ð›„ˆ", "ð›„‰", "ð›„Š", "ð›„‹", "ð›„Œ"]],
	["ã‚", ["ð›„", "ð›„Ž", "ð›„", "ð›„", "ð›„‘"]],
	null,
	["ã‚‘", ["ð›„’", "ð›„“", "ð›„”", "ð›„•"]],
	["ã‚’", ["ð›„–", "ð›„—", "ð›„˜", "ð›„™", "ð›„š", "ð›„›", "ð›„œ", "ð›€…"]],
	["ã‚“", ["ð›„", "ð›„ž"]],
	null,
	null,
	null,
	null,
] as const;

let text = $state(editor.text);

editor.onchange(() => {
	text = editor.text;
});
</script> 

<div class="float-menu" use:draggable={{ bounds: 'body' }} role="dialog" title="ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ç§»å‹•ã€ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ã—ã¦éš ã™" ondblclick={() => (shown = false)}>
  <div class="kana-table">
    {#each KANA_TABLE as k}
      {#if k}
        {@const [kana, variants] = k}
      <div class="row">
        <KanaButton display={kana} variants={variants} />
        </div>
      {:else}
        <div class="row"></div>
      {/if}
    {/each}
  </div>

</div>

<style>
  .float-menu {
    writing-mode: vertical-rl;

    position: fixed;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    background-color: #fbfbfb;
    z-index: 100;
    padding: 0.5em;
    gap: 0.5em;

    font-size: 0.85rem;

    border-radius: 0.5em;

    box-shadow: 4px 4px 1em #00000033;

    display: grid;
    grid-template-columns: auto 1fr;

    user-select: none;

		cursor: move;
  }

  .kana-table {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 0.25em;
  }
</style>
